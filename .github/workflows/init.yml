name: Kam Project Initialization

on:
  workflow_dispatch:
    inputs:
      template-url:
        description: "Template download URL (single template: .tar.gz; multiple templates: .zip) - leave empty to skip template import"
        required: false
        type: string
        default: "https://github.com/MemDeco-WG/Kam/releases/latest/download/templates.zip"
      init-command:
        description: "Full initialization command (complete command to run after setup/template import)"
        required: false
        type: string
        default: "kam init . --kam -f"
      enable-cache:
        description: "Toggle version-aware caching for kam and Cargo"
        required: false
        type: string
        default: "true"

jobs:
  run-initialization:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup kam
        uses: MemDeco-WG/setup-kam@latest
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          template-url: ${{ github.event.inputs.template-url }}
          enable-cache: ${{ github.event.inputs.enable-cache }}

      - name: Verify kam installation
        run: kam --version

      - name: Run initialization command
        shell: bash
        run: |
          echo "Running initialization command: ${{ github.event.inputs.init-command }}"
          ${{ github.event.inputs.init-command }}
          echo "Initialization completed successfully"
        env:
          GH_TOKEN: ${{ github.token }}
